<!doctype html><html lang="ja"><head><meta charset="UTF-8" /><meta name="viewport" content="width = device-width, initial-scale = 1, user-scalable = yes" /><link rel="stylesheet" type="text/css" href="css/style.css" /><title>無門関 - atsuageの使い方</title></head><body><header id="main-header"><h1><a href="./index.html">無門関</a></h1></header><main><header id="article-header"><div id="date">2018-04-11</div><h2 id="title">atsuageの使い方</h2></header><div id="article-main"><p>atsuageの使い方について説明します。 </p><h3>プロジェクトの作成</h3><p>atsuageが管理するWEBサイトの単位をプロジェクトと呼ぶことにします。これは通常、複数のHTMLファイルからなる、一つのWEBサイトと認識されるものだと想定しています。 </p><p>このプロジェクトは一つのディレクトリです。これを作成していきます。このディレクトリ(プロジェクト)の名前をここではmypagesとしておきましょう。 このディレクトリの親ディレクトリになるディレクトリに移動してください。例えば、/foo/bar/mypages/というディレクトリで管理をしたいなら、/foo/bar/ディレクトリに移動してください。 </p><pre><code>$ atsuage new-project mypages  
site-name: hoge  
autohor: piyo  
</code></pre><p>この時、site-nemaとauthorという2つの項目について、入力を求めます。これについては、後述しますが、プロジェクトのサイト名と著者名を表していると思ってください。 ここでは、site-nameはhoge、authorはpiyoとしました。 </p><p>このように、atsuage new-projectコマンドで、mypagesディレクトリが作成されます。mypagesディレクトリ下のファイルの構成は次のとおりです。 </p><ul><li>texts ディレクトリ (テキストファイル用のディレクトリ)<ul><li>index (テキストファイル)</li><li>project (テキストファイル)</li></ul></li><li>template ディレクトリ (テンプレートファイル用のディレクトリ)<ul><li>template (テンプレートファイル)</li></ul></li><li>pages ディレクトリ (作成されたHTMLが出力されるディレクトリ)</li><li>.atsuage ファイル (atsuageのためのプロジェクトの設定用ファイル)</li></ul><p>基本的には、textsディレクトリ以下に配置されたhogeというファイルの内容が、 templateディレクトリ下の指定されたファイルのテンプレートで、 pagesディレクトリ下にhoge.htmlとして、生成されるということがatsuageの処理の一連の流れになります。 </p><p>各ファイルの中身を確認していきましょう。各ファイルについては、下に更に詳しい説明が在ります。 </p><h4>テキストファイル</h4><p>最初に生成されたテキストファイルは2つでindexとprojectです。それぞれの中身は、 </p><pre><code>$ cat texts/index  
:TITLE sample page  
:DATE  
:PARENT  
:PREV  
:NEXT  
:TEXT  
### Hello!!  
 
* foo  
* bar  
* baz  
 
$ cat texts/project  
:SITE-NAME hoge  
:AUTHOR piyo </code></pre><p>となります。 </p><p>なんとなく分かるとは、思いますが、:から始まる行頭の文字列が各行や行の集まりについて指定をするラベルのような役割をしています。 indexの方では、:TITLEというラベルの内容がsample pageで:DATEや:PREVと言ったラベルの内容は空文字列です。:TEXTのように内容に複数の文字列を持つことも出来ます。 行頭の:TEXTに続けて直ぐに改行を入れると複数行の文字列を入れます。 </p><p>内容の意味としては、indexはindex.htmlページの内容を表していますが、projectの方はプロジェクト全体を表しています。 </p><p>atsuageでは、基本的にtexts以下のファイルはHTMLファイルに変換されますが、 projectのようにプロジェクト全体の情報を表すために用いるテキストファイルをHTMLファイルに変換しないように制御することが出来ます。 </p><p>次は設定用ファイルを見てみましょう。 </p><h4>.atsuageファイル</h4><p>上記のHTMLへの変換の制御等の設定などをするためのファイルが.atsuageファイルです。 </p><pre><code>$ cat .atsuage  
(:IGNORE ("project") :TEXT-FORMAT  
 (:DEFAULT  
  (:TITLE "title" :DATE "" :PARENT "" :PREV "" :NEXT "" :TEXT "please write  
...  
...  
"))  
 :DEFAULT-TEMPLATES NIL) </code></pre><p>このファイルはS式(plist)の形で記述します。:IGNOREプロパティで、先程述べたHTMLファイルに変換しないファイルを指定します。 ここでは、projectのみを無視する設定となっていますが、例えば何らかの全体的に適用されるデザインの数値的な値の集まりと、 表示する文字列の集まりのファイルを分けたいと言ったときなどに複数のファイルを指定することが出来ます。 </p><p>:TEXT-FORMATプロパティには、テキストファイルをatsuageの機能を用いて生成する際に、テキストファイルにどのようなラベルをどのような値で表示するかということが書かれています。 new-projectによる生成では、:TITLEの内容が別の文字列になっていますが、テキストファイルをatsuageを用いて生成する際には、各ラベルの内容を指定することも出来ます。 もちろん、生成後に編集しても問題はありません。 </p><p>:DEFAULT-TEMPLATESは、どのテンプレートファイルを用いてHTMLファイルを生成するかということをテキストファイル毎に指定すためのものです。 ここでは、NILとなっていますが、このときはすべてのテキストファイルでtemplateの内容を使用します。(NILは空リストなので、何も指定されていないということです。) </p><h4>テンプレートファイル</h4><p>テンプレートファイルの中身も見てみましょう。 </p><pre><code>$ cat templates/template  
(:html (:head (:title (get-value "site-name" "project")))  
       (:body (:h1 (get-value "site-name" "project"))  
              (:p "Welcome " (get-value "author" "project") "'s site")  
              (:h2 (get-value "title"))  
              (:main (get-value-as-md "text")))) </code></pre><p>テンプレートファイルは、このようにHTML風のS式となっています。この詳しい説明は下記を参照してください。:html :headなどは、これらがHTMLタグに変換されるということが、直感的に分かると思います。 get-valueや、get-value-as-mdなどの命令で、テキストファイルの内容を取得して、生成されるHTMLファイルに埋め込みます。 </p><h4>HTMLファイルの生成</h4><p>new-projectによって生成されるファイルの説明が済んだので、HTMLファイルを作成します。 </p><pre><code>$ atsuage refresh </code></pre><p>これで、pages以下にindex.htmlが作成されているはずです。お好きなブラウザで確認をしてみてください。refreshは、ignoreで指定された以外のすべてのテキストファイルをHTMLファイルに変換するコマンドです。 コマンドの詳細については、下記を参照してください。 </p><p>この時に、もう一つファイルが作成されています。mypages以下に、.update-timeというファイルが出来ています。 </p><pre><code>$ cat .update-time  
("index" 3732523497) </code></pre><p>数値は一例ですが、このファイルにはHTMLファイルが生成された時のテキストファイルの更新時間が記録されます。これとテキストファイルの更新時間をを元に、差分だけHTMLファイルを作成するコマンドupdateも用意しています。 </p><h3>テキストファイルについて</h3><p>テキストファイルの作成は大きく分けて2通りの方法があります。1つは、textsディレクトリ以下にテキストファイルを好きな方法で作成することです。 もう1つは、atsuageに用意されているnewコマンド、またはinewコマンドを用いることです。 </p><p>テキストファイルのフォーマットについては、<a href="https://github.com/t-sin/rosa">Rosa</a>のそれに従います。しかし、atsuageではラベルはすべて大文字に直されることに注意してください。 </p><pre><code>$ cat texts/hoge  
:TITLE sample  
:DATE 2018-04-14  
:PARENT piyo  
:PREV fuga  
:NEXT hogera  
:TEXT  
### Hello!!  
 
* foo  
* bar  
* baz </code></pre><p>例として、上のようなテキストファイルを考えます。ここで、複数行に跨がらない文字列の場合は、:TITLEや:DATEのようにラベルの後に半角スペースを1つ用いて、その後の改行までの文字列が、そのラベルの内容となります。 複数行の文字列を内容としたい場合には、:TEXTのようにラベルの直後で改行をして、その後新しいラベルが出現するまでの複数行の文字列が、そのラベルの内容となります。もう一つ例を見ましょう。 </p><pre><code>$ cat texts/piyo  
:CHILD hoge  
:CHILD fuga  
:CHILD hogera  
:TITLE piyopiyo  
:DATE 2018-04-14  
:PARENT  
:PREV  
:NEXT  
:TEXT </code></pre><p>ここでは、:CHLIDラベルが複数あります。このように複数同じラベルのものがあるときには、これを配列やリストとして取り扱うことが出来ます。 (1つであっても要素一つのリストとして扱うことが出来ます。そのままでは、あまり意味はないでしょうけれども。) </p><h4>特別なラベル</h4><p>atsuageは、:PARENT :CHILD :NEXT :PREVという記事同士の関係を扱うラベルを特別なラベルとして扱います。pageコマンドやupdateコマンド、refreshコマンドでHTMLが生成される際には、:PARENT :PREVの内容が指定するファイルに、:CHILD :NEXTのラベルの内容を追加しに行きます。これによって、ある程度では在りますが、例えば日記などの記事の関係を自動的に更新することが出来ます。 </p><h4>.atsuageファイルの:TEXT-FORMATプロパティ</h4><pre><code>$ cat .atsuage  
(:IGNORE ("project") :TEXT-FORMAT  
 (:DEFAULT  
  (:TITLE "title" :DATE "" :PARENT "" :PREV "" :NEXT "" :TEXT "please write  
...  
...  
"))  
 :DEFAULT-TEMPLATES NIL) </code></pre><p>.atsuageファイルの:TEXT-FORMATプロパティでは、先にも述べたように、デフォルトで使用される。あるいはnewもしくはinewコマンドで、指定するテキストファイルの雛形を設定することが出来ます。 :TEXT-FORMATの値となるplistの各プロパティの値が、テキストファイルの雛形となるplistです。雛形が指定されないときは、:DEFAULTプロパティの値が使用されます。 もし、.atsuageファイルの:TEXT-FORMATプロパティが無いや、:TEXT-FORMATプロパティの:DEFAULTプロパティが無い場合には、new-projectコマンドで生成される.atsuageファイルの:TEXT-FORMATプロパティの:DEFAULTプロパティと同じものを雛形として使用します。 </p><h5>雛形における特別な値</h5><p>:dateはYYYY-MM-DD(-連番)?の形で、作成した(new, inewコマンドを叩いた)日時を計算して用います。 </p><h4>特別な名前</h4><p>newコマンド、inewコマンドの第一引数を\dateとした時にYYYY-MM-DD(-連番)?の形で、作成した(new, inewコマンドを叩いた)日時を計算して名前として用います。 </p><h3>HTMLファイルの作成</h3><p>HTMLファイルを作成する方法として、まず単一のテキストファイルを処理したいのか、プロジェクト全体のテキストファイルを処理したいのかによって二通りに分かれます。 </p><h4>単一のテキストファイルを処理する場合</h4><p>単一のテキストファイルのみを処理する場合には、pageコマンドを用います。 hogeという名前のテキストファイルを処理する場合には、 </p><pre><code>$ atsuage page hoge </code></pre><p>とします。 これで、.atsuageに特に指定がされていない場合には(指定の仕方ついては後述)、templateという名前のテンプレートファイル（templates/template）と、texts/hogeを用いて、HTMLファイルを作成します。 </p><p>templates/以下に、別のテンプレートファイル、例えばpiyoという名前のものを用意していた時に、これを用いたい場合には、 </p><pre><code>$ atsuage page hoge piyo </code></pre><p>とします。これで、明示的に texts/hogeとtemplate/piyoを用いてHTMLファイルを作成することが出来ます。 </p><p>しかし、ある特別なファイル、例えば日記について各記事のページ用のものをデフォルトの雛形として、一覧のページは別の雛形を使いたい場合に、一覧のページを処理するときのみデフォルトの雛形を変更したいという場合があると思います。 このような場合に、例えば、hogeというテキストファイルはデフォルトでpiyoというテンプレートファイルを用いて、HTMLファイルの作成を行いたい場合には、 </p><pre><code>$ cat .atsuage  
(:IGNORE ("project") :TEXT-FORMAT  
 (:DEFAULT  
  (:TITLE "title" :DATE "" :PARENT "" :PREV "" :NEXT "" :TEXT "please write  
...  
...  
"))  
 :DEFAULT-TEMPLATES （("hoge" . "piyo")）) </code></pre><p>のように、.atsuageファイルの:DEFAULT-TEMPLATESに上記のように、テキストファイル名（car部）とテンプレートファイル名(cdr部)のコンスセルで表します。この設定があると、 </p><pre><code>$ atsuage page hoge </code></pre><p>とした時に、テンプレートとして、templates/piyoが用いられます。 </p><p>注意事項として、pageコマンドでは、:PREV :PARENTプロパティに関する解決を行います。 </p><h4>プロジェクト全体のテキストファイルを処理する場合</h4><p>以下の３つのコマンドがある。 どれも、プロジェクト全体として、テキストファイルからHTMLファイルを生成しようとするコマンドである。 </p><ul><li>updateでは、最終更新日を確認することにより、更新されたテキストファイルのみ処理を行います。(:PREV :PARENTプロパティに関する解決を行います。)</li><li>make-allでは、すべてのテキストファイルの処理を行いますが、:PREV :PARENTプロパティに関する解決を行いません。</li><li>reflechでは、すべてのテキストファイルの処理を行い、:PREV :PARENTプロパティに関する解決も行います。</li></ul><h3>templateファイル</h3><h3>コマンド一覧</h3><p>コマンドごとの解説です。 </p><h4>help コマンド</h4><p>helpコマンドでは、コマンドの一覧と簡単な説明を表示します。 </p><pre><code>$ atsuage help  
 
atsuage  
 
  version 0.1.1  
 
  simple static site generator  
 
  commands  
 
    new-project [name] : make new project  
    new [name] : make new text  
    new [name] [format] : make new text using specified format  
    inew [name] : make new text (interactive)  
    inew [name] [format] : make new text using specified format (interactive)  
    page [name] : make page and resolve relation  
    page [name] [template] : make page using specified template and resolve relation  
    update : make pages and resolve relation (updated texts only)  
    page-all : make pages (all texts) this dosen't resolve relation  
    refresh : make pages (all texts) this resolve relation  
    dir : show current project directry  
    texts : show text list  
    conf : show config  
    updated : show updated text files  
    help : show help message </code></pre><h4>new-project コマンド</h4><p>new-projectコマンドは、新たにプロジェクトを作成します。 </p><h4>new コマンド</h4><p>newコマンドは、texts以下にテキストファイルを作成します。引数は1つ、もしくは2つです。 </p><pre><code>$ atsuage new hoge </code></pre><p>のように1つであれば、.atsuageで指定した:DEFAULTの雛形でテキストファイルを作成します。 もし、:TEXT-FORMATプロパティの:DEFAULTプロパティが指定されていなければ、new-projectした際にできる:TEXT-FORMATプロパティの:DEFAULTプロパティと同じ雛形で、テキストファイル(texts/hoge)が作成されます。 </p><pre><code>$ atsuage new hoge piyo </code></pre><p>のように2つの引数である場合、2つめの引数(上の例ではpiyo)で雛形を指定します。これは、.atsuageファイルの:TEXT-FORMATプロパティから雛形を探して、使用します。 この例では、:PIYOプロパティを用いてテキストファイル(texts/hoge)が作成されます。 </p><h4>inew コマンド</h4><p>inewコマンドは、newコマンドと同じように、テキストファイルを作成します。 ただし、inewコマンドの場合は、newコマンドと違ってテキストファイルに出力される各タグの内容を対話的に指定することが出来ます。 (inewのiはinteractiveのiです。) </p><pre><code>$ atsuage inew hoge  
TITLE: (default: title) hoge  
DATE: (default: ) 2018-04-14  
PARENT: (default: )  
PREV: (default: )  
NEXT: (default: ) </code></pre><p>このように、各ラベルの内容を対話的に指定できます。ただし、ここで指定できる内容は単一行の物に限られます。空文字が入力された場合には、default: として表示されている値を用います。 </p><h4>page コマンド</h4><p>pageコマンドは、 一つのテキストファイルについて処理する(テンプレートと合わせて、HTMLファイルを生成する)ためのコマンドです。 </p><pre><code>$ atsuage page hoge </code></pre><p>のように、第一引数だけの場合には、デフォルトとして設定された、あるいはtemplateという名前のテンプレートファイルを用います。 第一引数はテキストファイルの名前です。 </p><pre><code>$ atsuage page hoge piyo </code></pre><p>のように、第二引数もある場合は、第二引数で指定された名前のテンプレートファイルを用いてHTMLファイルを生成します。 上記の例ですと、texts/hoge(テキストファイル)とtemplates/piyo(テンプレートファイル)を用いて、HTMLファイルを生成します。 </p><h4>update コマンド</h4><p>最終更新日を確認することにより、更新されたテキストファイルのみ処理を行います。(:PREV :PARENTプロパティに関する解決を行います。) </p><h4>page-all コマンド</h4><p>すべてのテキストファイルの処理を行いますが、:PREV :PARENTプロパティに関する解決を行いません。 </p><h4>refresh コマンド</h4><p>すべてのテキストファイルの処理を行い、:PREV :PARENTプロパティに関する解決も行います。 </p><h4>dir コマンド</h4><p>dirコマンドは、カレントディレクトリでatsuageのコマンドを用いた場合には、どのプロジェクトを操作するかを表示します。 内部の処理では、.atsuageファイルの存在するディレクトリをカレントディレクトリから親ディレクトリに上がっていきながら探します。 </p><p>/home/mypages/ディレクトリがプロジェクトのディレクトリである時に、/home/mypages/texts/ディレクトリ内でコマンドを実行したとすると以下のようになります。 </p><pre><code>$ atsuage dir  
/home/mypages/ </code></pre><h4>texts コマンド</h4><p>textsディレクトリ以下のファイル名一覧を表示します。 </p><h4>conf コマンド</h4><p>.atsuageファイルの中身を表示します。 </p><h4>updated コマンド</h4><p>.update-timeファイルとテキストファイルの更新時間を比較して、テキストファイル更新後にHTMLファイルに変換されていないファイルの一覧を表示します。 簡単に言うと、これらのファイルがupdateコマンドで更新される対象となります。 </p></div><footer id="article-footer">UP: <a href="atsuage.html">atsuage</a> PREV: <a href=".html"></a> NEXT: <a href=".html"></a></footer></main><footer id="main-footer"><div id="icnos"><a href="https://twitter.com/myao_s_moking"><img src="img/twit.png" class="icon-img" /></a><a href="https://github.com/myaosato"><img src="img/github.png" class="icon-img" /></a></div><div id="copyright">&copy;2010 Satoaki Miyao</div></footer></body></html>